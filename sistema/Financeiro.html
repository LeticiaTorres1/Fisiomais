<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.6">
    <title>Sistema Financeiro Clínica Pro</title>
    <style>
        :root {
            --primary: #1D3D44; 
            --secondary: #17C3B2; 
            --success: #10b981;
            --danger: #ef4444;
            --dark: #13292D;    
            --light: #F0F4F4;   
            --white: #ffffff;
            --warning: #f59e0b;
            --purple: #8b5cf6;
            --gray: #64748b;
        }


        body { font-family: 'Inter', sans-serif; background-color: var(--light); margin: 0; color: var(--primary); overflow-x: hidden; }
       
        .navbar {
            background: var(--primary); color: white; padding: 15px 30px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 3px solid var(--secondary);
        }


        .filter-group { display: flex; gap: 10px; align-items: center; }
        select, button { padding: 10px; border-radius: 6px; border: 1px solid #334155; font-size: 0.9rem; }
       
        .btn-filter { background: var(--secondary); color: var(--primary); border: none; font-weight: bold; cursor: pointer; }
        .btn-report { background: var(--white); color: var(--primary); border: 2px solid var(--secondary); font-weight: bold; cursor: pointer; padding: 10px 20px; transition: 0.3s; }
        .btn-report:hover { background: var(--secondary); color: white; }
        .btn-back { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; margin-bottom: 20px; }


        .container { max-width: 1200px; margin: auto; padding: 20px; transition: 0.3s; }
        .hidden { display: none; }


        .top-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid var(--secondary); }
        .stat-card small { color: var(--gray); font-weight: 600; text-transform: uppercase; font-size: 0.75rem; }
        .stat-card .value { font-size: 1.5rem; font-weight: 800; margin-top: 8px; display: block; color: var(--primary); }


        .info-row { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .mini-card { background: var(--white); padding: 15px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 15px; }
        .icon-circle { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .alert-box { background: #E9F7F6; border: 1px solid var(--secondary); padding: 15px; border-radius: 12px; }
        .alert-item { display: flex; justify-content: space-between; font-size: 0.85rem; padding: 5px 0; border-bottom: 1px solid #d1efec; }
        .revenue-mix { display: flex; height: 25px; border-radius: 5px; overflow: hidden; margin-top: 15px; }


        .grid-tables { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .grid-tables { grid-template-columns: 1fr; } .info-row { grid-template-columns: 1fr; } }


        .card { background: var(--white); padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h3 { color: var(--primary); border-left: 4px solid var(--secondary); padding-left: 10px; }
       
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; background: #F8FAFA; font-size: 0.8rem; color: var(--primary); text-transform: uppercase; border-bottom: 2px solid var(--secondary); }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 0.95rem; }
        tfoot tr td { background: #F8FAFA; font-weight: bold; border-top: 2px solid var(--secondary); }


        .text-danger { color: var(--danger); font-weight: bold; }
        .text-success { color: #00897b; font-weight: bold; }
        .text-warning { color: var(--warning); font-weight: bold; }


        #loading { display: none; position: fixed; inset: 0; background: rgba(29, 61, 68, 0.9); z-index: 2000; justify-content: center; align-items: center; font-weight: bold; color: var(--secondary); }
       
        .report-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .report-box { border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; background: #fff; }
        .report-box h4 { margin: 0 0 10px 0; color: var(--primary); font-size: 0.85rem; text-transform: uppercase; border-bottom: 2px solid var(--secondary); padding-bottom: 8px; }
        .data-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.9rem; border-bottom: 1px dashed #f1f5f9; }
        .analysis-text { background: #E9F7F6; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary); line-height: 1.6; font-size: 0.95rem; color: var(--primary); }
       
        .progress-bar { background: #e2e8f0; height: 10px; border-radius: 5px; margin-top: 10px; overflow: hidden; }
        .progress-fill { background: var(--secondary); height: 100%; transition: width 0.5s; }


        footer { text-align: center; padding: 20px; color: var(--primary); font-size: 0.8rem; opacity: 0.7; }
    </style>
</head>
<body>




<div id="loading">PROCESSANDO DADOS...</div>




<div class="navbar">
    <div><strong style="letter-spacing: 1px;">CLÍNICA FISIO+ | CONTROLE FINANCEIRO</strong></div>
    <div class="filter-group">
        <select id="selAno" onchange="validarMeses()">
            <option value="2024">2024</option>
            <option value="2025">2025</option>
            <option value="2026" selected>2026</option>
        </select>
        <select id="selMes"></select>
        <button class="btn-filter" onclick="processar()">Filtrar</button>
        <button class="btn-report" onclick="toggleView('relatorio')">Relatórios</button>
    </div>
</div>




<div id="page-dashboard" class="container">
    <div class="top-stats">
        <div class="stat-card"><small>Faturamento Bruto</small><span id="fatBruto" class="value text-success">R$ 0,00</span></div>
        <div class="stat-card" style="border-top-color: var(--danger);"><small>Total de Despesas</small><span id="totalGastos" class="value text-danger">R$ 0,00</span></div>
        <div class="stat-card" style="border-top-color: var(--primary);"><small>Ticket Médio</small><span id="ticketMedio" class="value">R$ 0,00</span></div>
        <div class="stat-card" style="border-top-color: var(--secondary);"><small>Lucro Líquido Real</small><span id="lucroReal" class="value">R$ 0,00</span></div>
    </div>




    <div class="info-row">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="mini-card">
                <div class="icon-circle" style="background: var(--primary);">P</div>
                <div><small style="color:var(--gray)">Pacientes Atendidos</small><br><strong id="totalPacientes" style="font-size: 1.2rem;">0</strong></div>
            </div>
            <div class="mini-card">
                <div class="icon-circle" style="background: var(--secondary);">M</div>
                <div><small style="color:var(--gray)">Margem Operacional</small><br><strong id="margemCard" style="font-size: 1.2rem;">0%</strong></div>
            </div>
            <div class="card" style="grid-column: span 2; margin-bottom: 0; padding: 15px;">
                <small style="font-weight: bold; color: var(--primary);">MIX DE FATURAMENTO (POR PLANO)</small>
                <div class="revenue-mix" id="mixBar"></div>
            </div>
        </div>
       
        <div class="alert-box">
            <strong style="font-size: 0.8rem; color: var(--primary);">⚠️ LEMBRETES DO PERÍODO</strong>
            <div class="alert-item" style="margin-top:10px;"><span>Renovação de Software</span> <strong>Dia 05</strong></div>
            <div class="alert-item"><span>Repasse Profissionais</span> <strong>Dia 10</strong></div>
            <div class="alert-item"><span>Vencimento Aluguel</span> <strong>Dia 15</strong></div>
            <div class="alert-item" style="border:none"><span>Impostos (DAS)</span> <strong>Dia 20</strong></div>
        </div>
    </div>




    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0;">Progresso da Meta de Faturamento</h3>
            <span id="percentMeta" style="font-weight: 800; color: var(--secondary);">0%</span>
        </div>
        <div class="progress-bar"><div id="fillMeta" class="progress-fill" style="width: 0%"></div></div>
    </div>




    <div class="grid-tables">
        <div class="card">
            <h3>Entradas: Planos (<span id="txtPeriodo"></span>)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Plano</th>
                        <th>Valor Unit.</th>
                        <th>Pacientes</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody id="corpoTabelaEntrada"></tbody>
                <tfoot id="totalEntrada"></tfoot>
            </table>
        </div>
        <div class="card">
            <h3>Saídas: Gastos Operacionais</h3>
            <table>
                <thead><tr><th>Categoria</th><th>Valor</th></tr></thead>
                <tbody id="corpoTabelaSaida"></tbody>
                <tfoot id="totalSaida"></tfoot>
            </table>
        </div>
    </div>
</div>




<div id="page-relatorio" class="container hidden">
    <button class="btn-back" onclick="toggleView('dashboard')">← Voltar ao Painel</button>
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--secondary); padding-bottom: 15px;">
            <h2 style="margin:0">Relatório de Gestão Executiva - <span id="relPeriodo"></span></h2>
        </div>
        <div class="report-section">
            <div class="report-box">
                <h4>1. Fluxo de Receita Detalhado</h4>
                <div class="data-row"><span>Faturamento Bruto:</span> <strong id="relBruto"></strong></div>
                <div class="data-row"><span>(-) Glosas/Negativas (2%):</span> <span id="relGlosas" class="text-danger"></span></div>
                <div class="data-row"><span>(-) Taxas de Cartão (2.5%):</span> <span id="relTaxas" class="text-danger"></span></div>
                <div class="data-row" style="background: #F8FAFA;"><span>(=) Receita Líquida:</span> <strong id="relLiquida" class="text-success"></strong></div>
            </div>
            <div class="report-box">
                <h4>2. Distribuição de Custos</h4>
                <div class="data-row"><span>Folha e Repasses (35%):</span> <span id="relFolha"></span></div>
                <div class="data-row"><span>Custos Operacionais (Insumos):</span> <span id="relInsumos"></span></div>
                <div class="data-row"><span>Custos de Ocupação:</span> <span id="relOcupacao"></span></div>
                <div class="data-row"><span>Impostos (DAS):</span> <span id="relImpostos"></span></div>
            </div>
            <div class="report-box">
                <h4>3. Indicadores de Eficiência</h4>
                <div class="data-row"><span>Ticket Médio / Paciente:</span> <strong id="relTicket"></strong></div>
                <div class="data-row"><span>Margem de Lucro:</span> <strong id="relMargem"></strong></div>
                <div class="data-row"><span>Taxa de No-Show (Faltas):</span> <span class="text-warning">12%</span></div>
                <div class="data-row"><span>Perda Estimada (Faltas):</span> <span id="relPerdaFaltas" class="text-danger"></span></div>
            </div>
        </div>
        <div class="report-section">
            <div class="report-box">
                <h4>4. Gestão de Corpo Clínico</h4>
                <div class="data-row"><span>Total Repassado Médicos:</span> <strong id="relRepasseMed"></strong></div>
                <div class="data-row"><span>Encargos e Benefícios:</span> <span>R$ 4.200,00</span></div>
                <div class="data-row"><span>Produtividade Média:</span> <span class="text-success">Alta</span></div>
                <div class="data-row"><span>Custo por Atendimento:</span> <span id="relCustoAtend"></span></div>
            </div>
            <div class="report-box">
                <h4>5. Estrutura de Ponto de Equilíbrio</h4>
                <div class="data-row"><span>Custos Fixos Totais:</span> <strong id="relFixos"></strong></div>
                <div class="data-row"><span>Custos Variáveis (Méd):</span> <span id="relVariaveis"></span></div>
                <div class="data-row"><span>Ponto de Equilíbrio (Mínimo):</span> <strong class="text-primary" id="relBreakEven"></strong></div>
                <div class="data-row"><span>Dias para Cobrir Custos:</span> <span>18 Dias</span></div>
            </div>
            <div class="report-box">
                <h4>6. Valor do Cliente (LTV)</h4>
                <div class="data-row"><span>Retenção de Pacientes:</span> <span>78%</span></div>
                <div class="data-row"><span>Custo de Aquisição:</span> <span>R$ 45,00</span></div>
                <div class="data-row"><span>Lifetime Value Estimado:</span> <strong class="text-success">R$ 2.400,00</strong></div>
                <div class="data-row"><span>Retorno sobre Investimento:</span> <span>4.2x</span></div>
            </div>
        </div>
        <div class="report-section" style="grid-template-columns: 1fr 1fr;">
            <div class="report-box" style="border-top: 4px solid var(--primary);">
                <h4>7. Projeção Próximo Mês & Cenários</h4>
                <div class="data-row"><span>Cenário Otimista (+10%):</span> <span id="relOtimista" class="text-success"></span></div>
                <div class="data-row"><span>Cenário Realista:</span> <span id="relRealista"></span></div>
                <div class="data-row"><span>Cenário Pessimista (-15%):</span> <span id="relPessimista" class="text-danger"></span></div>
            </div>
            <div class="report-box" style="border-top: 4px solid var(--secondary);">
                <h4>8. Plano de Ação & Insights</h4>
                <div id="analiseIA" class="analysis-text"></div>
            </div>
        </div>
    </div>
</div>




<script>
    const mesesNomes = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
    const valPlanos = [150, 280, 420, 550];
    const nomPlanos = ["BÁSICO", "ESSENCIAL", "AVANÇADO", "PREMIUM"];
    const coresPlanos = ["#1D3D44", "#17C3B2", "#2A5A63", "#45ADA8"];




    function toggleView(v) {
        document.getElementById('page-dashboard').className = v === 'dashboard' ? 'container' : 'container hidden';
        document.getElementById('page-relatorio').className = v === 'relatorio' ? 'container' : 'container hidden';
    }




    function validarMeses() {
        const ano = document.getElementById('selAno').value;
        const selMes = document.getElementById('selMes');
        selMes.innerHTML = '<option value="total">Acumulado do Ano</option>';
        mesesNomes.forEach((n, i) => {
            if(ano < 2026 || i === 0) selMes.innerHTML += `<option value="${i}">${n}</option>`;
        });
    }




    function gerarDados(ano, mes) {
        const seed = parseInt(ano) + (mes === 'total' ? 50 : parseInt(mes));
        const mult = (ano == 2026 ? 1.4 : (ano == 2025 ? 1.2 : 1.0)) * (1 + (seed % 10) / 100);
        const pacs = [Math.floor(60 * mult), Math.floor(85 * mult), Math.floor(45 * mult), Math.floor(25 * mult)];
        const faturamentoPlanos = pacs.reduce((acc, p, i) => acc + (p * valPlanos[i]), 0);
        const gastos = { profissionais: faturamentoPlanos * 0.35, equipamentos: 4500 * mult, manutencao: 1200 * mult, impostos: faturamentoPlanos * 0.06, diversos: 1500 * mult };
        return { bruto: faturamentoPlanos, gastosDetalhado: gastos, totalGastos: Object.values(gastos).reduce((a, b) => a + b, 0), lucro: faturamentoPlanos - Object.values(gastos).reduce((a, b) => a + b, 0), pacs: pacs };
    }




    function processar() {
        document.getElementById('loading').style.display = 'flex';
        setTimeout(() => {
            const ano = document.getElementById('selAno').value;
            const mes = document.getElementById('selMes').value;
            let d = (mes === 'total') ? gerarDados(ano, 0) : gerarDados(ano, parseInt(mes));
            if(mes === 'total') {
                const mesesNoAno = (ano == 2026) ? 1 : 12;
                d.bruto *= mesesNoAno; d.totalGastos *= mesesNoAno; d.lucro *= mesesNoAno;
                d.pacs = d.pacs.map(p => p * mesesNoAno);
                Object.keys(d.gastosDetalhado).forEach(k => d.gastosDetalhado[k] *= mesesNoAno);
            }
            renderizar(d, ano, mes);
            renderizarRelatorio(d, ano, mes);
            document.getElementById('loading').style.display = 'none';
        }, 400);
    }




    function renderizar(d, ano, mes) {
        const pTexto = mes === 'total' ? `Acumulado ${ano}` : `${mesesNomes[mes]}/${ano}`;
        document.getElementById('txtPeriodo').innerText = pTexto;
        document.getElementById('fatBruto').innerText = d.bruto.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('totalGastos').innerText = d.totalGastos.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('lucroReal').innerText = d.lucro.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        const totalP = d.pacs.reduce((a, b) => a + b, 0);
        document.getElementById('totalPacientes').innerText = totalP;
        document.getElementById('ticketMedio').innerText = (d.bruto / totalP).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('margemCard').innerText = ((d.lucro / d.bruto) * 100).toFixed(1) + "%";
       
        document.getElementById('corpoTabelaEntrada').innerHTML = d.pacs.map((p, i) => `
            <tr>
                <td>${nomPlanos[i]}</td>
                <td>R$ ${valPlanos[i].toFixed(2)}</td>
                <td>${p}</td>
                <td>${(p*valPlanos[i]).toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</td>
            </tr>`).join('');
       
        document.getElementById('totalEntrada').innerHTML = `<tr><td colspan="2">TOTAL</td><td>${totalP}</td><td>${d.bruto.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</td></tr>`;


        const metaBase = mes === 'total' ? 960000 : 80000;
        const percent = Math.min((d.bruto / metaBase) * 100, 100).toFixed(1);
        document.getElementById('percentMeta').innerText = percent + "%";
        document.getElementById('fillMeta').style.width = percent + "%";


        const mixBar = document.getElementById('mixBar');
        mixBar.innerHTML = "";
        d.pacs.forEach((p, i) => { mixBar.innerHTML += `<div style="width: ${(p*valPlanos[i]/d.bruto)*100}%; background: ${coresPlanos[i]}"></div>`; });


        const labels = { profissionais: "Repasses", equipamentos: "Insumos", manutencao: "Ocupação", impostos: "Impostos", diversos: "Outros" };
        document.getElementById('corpoTabelaSaida').innerHTML = Object.keys(d.gastosDetalhado).map(key => `<tr><td>${labels[key]}</td><td class="text-danger">- ${d.gastosDetalhado[key].toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</td></tr>`).join('');
        document.getElementById('totalSaida').innerHTML = `<tr><td>TOTAL</td><td class="text-danger">- ${d.totalGastos.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</td></tr>`;
    }


    function renderizarRelatorio(d, ano, mes) {
        const pTexto = mes === 'total' ? `Acumulado ${ano}` : `${mesesNomes[mes]}/${ano}`;
        document.getElementById('relPeriodo').innerText = pTexto;
        const glosas = d.bruto * 0.02; const taxasCartao = d.bruto * 0.025; const receitaLiquida = d.bruto - glosas - taxasCartao;
        const margem = (d.lucro / d.bruto) * 100; const perdaNoShow = d.bruto * 0.12; const totalP = d.pacs.reduce((a,b)=>a+b,0);
       
        document.getElementById('relBruto').innerText = d.bruto.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relGlosas').innerText = "- " + glosas.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relTaxas').innerText = "- " + taxasCartao.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relLiquida').innerText = receitaLiquida.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
       
        document.getElementById('relFolha').innerText = d.gastosDetalhado.profissionais.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relInsumos').innerText = d.gastosDetalhado.equipamentos.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relOcupacao').innerText = d.gastosDetalhado.manutencao.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relImpostos').innerText = d.gastosDetalhado.impostos.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
       
        document.getElementById('relTicket').innerText = (d.bruto / totalP).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relMargem').innerText = margem.toFixed(1) + "%";
        document.getElementById('relPerdaFaltas').innerText = "- " + perdaNoShow.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
       
        document.getElementById('relRepasseMed').innerText = d.gastosDetalhado.profissionais.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relCustoAtend').innerText = (d.totalGastos / totalP).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
       
        const custosFixos = d.gastosDetalhado.manutencao + 4200 + 1500;
        document.getElementById('relFixos').innerText = custosFixos.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relVariaveis').innerText = (d.gastosDetalhado.profissionais + d.gastosDetalhado.equipamentos).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relBreakEven').innerText = (custosFixos / 0.4).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
       
        document.getElementById('relOtimista').innerText = (d.bruto * 1.1).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relRealista').innerText = d.bruto.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('relPessimista').innerText = (d.bruto * 0.85).toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
       
        document.getElementById('analiseIA').innerHTML = `A margem de <strong>${margem.toFixed(1)}%</strong> indica excelente performance com a nova paleta. Recomendamos atenção ao No-Show que gerou uma perda de <strong>${perdaNoShow.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</strong>.`;
    }


    window.onload = () => { validarMeses(); processar(); };
</script>


    <footer>
        <p>&copy; 2026 Fisio + Terapia. Todos os direitos reservados.</p>
    </footer>
</body>
</html>
